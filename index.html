<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gastos Ingenier√≠a</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    />
  </head>
  <body>
    <div class="page">
      <aside class="sidebar" id="sidebar">
        <div class="brand">
          <img src="LOGO1.jpeg" alt="Logo Gastos Ingenier√≠a" class="brand__logo" />
          <div>
            <p class="brand__title">Gastos Ingenier√≠a</p>
            <p class="brand__subtitle">Control de caja menor</p>
          </div>
        </div>

        <div class="user-card" id="user-card">
          <div>
            <p class="label">Usuario activo</p>
            <p class="user-card__name" id="user-summary">Sin sesi√≥n</p>
          </div>
          <button class="button button--ghost" id="logout-button" type="button">Cerrar sesi√≥n</button>
        </div>

        <nav class="nav" id="main-nav">
          <button class="nav__item is-active" data-view="dashboard">Panel general</button>
          <button class="nav__item" data-view="clients" id="clients-nav">Clientes</button>
          <button class="nav__item" data-view="projects" id="projects-nav">Proyectos</button>
          <button class="nav__item" data-view="expenses">Egresos</button>
          <button class="nav__item" data-view="reports" id="reports-nav">Reportes</button>
          <button class="nav__item" data-view="users" id="users-nav">Usuarios</button>
        </nav>

        <div class="sidebar__meta hidden" id="sidebar-meta"></div>
      </aside>

      <main class="main">
        <header class="main__header">
          <div>
            <p class="eyebrow" id="view-eyebrow">Panel general</p>
            <h1 id="view-title">Resumen operativo</h1>
            <p class="subtitle" id="view-subtitle">
              Visualiza el estado de las cajas menores y los √∫ltimos egresos registrados.
            </p>
          </div>
          <div class="header__actions">
            <button class="button button--ghost header__menu" id="menu-toggle" type="button" aria-label="Abrir men√∫">‚ò∞</button>      
          </div>
        </header>

        <section class="login" id="login-section">
          <div class="login__card">
            <img src="LOGO.jpeg" alt="Logo" class="login__logo" />
            <h2>Ingreso al aplicativo</h2>
            <p>Usa tus credenciales para administrar clientes, proyectos y egresos.</p>
            <form id="login-form" class="form">
              <label>
                Usuario
                <input type="text" id="login-username" required />
              </label>
              <label>
                Contrase√±a
                <input type="password" id="login-password" required />
              </label>
              <button type="submit" class="button">Entrar</button>
              <p class="form__helper" id="login-message"></p>
              <button type="button" class="button button--ghost" id="reset-password">¬øOlvidaste tu contrase√±a?</button>
            </form>
          </div>
        </section>

        <section class="app hidden" id="app-section">
          <div class="view is-active" data-view="dashboard">
            <div class="stats">
              <div class="stat-card">
                <p class="label">Clientes activos</p>
                <h3 id="stat-clients">0</h3>
              </div>
              <div class="stat-card">
                <p class="label">Proyectos en curso</p>
                <h3 id="stat-projects">0</h3>
              </div>
              <div class="stat-card">
                <p class="label">Base total</p>
                <h3 id="stat-base">$0</h3>
              </div>
              <div class="stat-card">
                <p class="label">Saldo disponible</p>
                <h3 id="stat-remaining">$0</h3>
              </div>
            </div>

            <div class="card">
              <div class="card__header">
                <h3>Cajas menores por proyecto</h3>
                <p>Saldo disponible y estado actual de cada proyecto.</p>
              </div>
              <div id="balances" class="list"></div>
            </div>

            <div class="card">
              <div class="card__header">
                <h3>√öltimos egresos</h3>
                <p>Registros recientes con categor√≠a, valor y proyecto.</p>
              </div>
              <div id="recent-expenses" class="list"></div>
            </div>
          </div>

          <div class="view" data-view="clients">
            <div class="card-grid">
              <form id="client-form" class="form card">
                <h3>Registrar cliente</h3>
                <label>
                  Nombre del cliente
                  <input type="text" id="client-name" required />
                </label>
                <label>
                  Ciudad principal
                  <input type="text" id="client-city" required />
                </label>
                <label>
                  Contacto
                  <input type="text" id="client-contact" placeholder="Nombre o correo" />
                </label>
                <button type="submit" class="button">Guardar cliente</button>
                <p class="form__helper" id="client-message"></p>
              </form>

              <div class="card">
                <div class="card__header">
                  <h3>Clientes registrados</h3>
                  <p>Gestiona los clientes y visualiza su n√∫mero de proyectos.</p>
                </div>
                <div id="client-list" class="list"></div>
              </div>
            </div>
          </div>

          <div class="view" data-view="projects">
            <div class="card-grid">
              <form id="project-form" class="form card">
                <h3>Crear proyecto y caja menor</h3>
                <label>
                  Cliente
                  <select id="project-client" required></select>
                </label>
                <label>
                  C√≥digo / ID del proyecto
                  <input type="text" id="project-code" required />
                </label>
                <label>
                  Nombre del proyecto
                  <input type="text" id="project-name" required />
                </label>
                <label>
                  Ciudad del proyecto
                  <input type="text" id="project-city" required />
                </label>
                <label>
                  Responsable del proyecto
                  <select id="project-responsible" required></select>
                </label>
                <label>
                  Base inicial de caja menor
                  <input type="number" id="project-base" min="1" required />
                </label>
                <label>
                  Observaciones
                  <textarea id="project-notes" rows="3" placeholder="Resumen del alcance, ubicaciones o notas clave"></textarea>
                </label>
                <button type="submit" class="button">Guardar proyecto</button>
                <p class="form__helper" id="project-message"></p>
              </form>

              <div class="card">
                <div class="card__header">
                  <h3>Proyectos activos</h3>
                  <p>Saldo disponible y cajas menores asignadas.</p>
                </div>
                <div id="project-list" class="list"></div>
              </div>
            </div>
          </div>

          <div class="view" data-view="expenses">
            <div class="card-grid">
              <form id="expense-form" class="form card">
                <h3>Registrar egreso</h3>
                <label>
                  Cliente
                  <select id="expense-client" required></select>
                </label>
                <label>
                  Ciudad
                  <select id="expense-city" required></select>
                </label>
                <label>
                  Proyecto
                  <select id="expense-project" required></select>
                </label>
                <div class="inline-fields">
                  <label>
                    Saldo disponible
                    <input type="text" id="expense-remaining" readonly />
                  </label>
                  <label>
                    Fecha
                    <input type="date" id="expense-date" required />
                  </label>
                </div>
                <label>
                  Concepto
                  <select id="expense-category" required></select>
                </label>
                <label>
                  Descripci√≥n del concepto
                  <textarea id="expense-description" rows="3" required></textarea>
                </label>
                <label>
                  Valor del egreso
                  <input type="number" id="expense-amount" min="1" required />
                </label>
                <label>
                  Observaciones / solicitud adicional
                  <textarea id="expense-notes" rows="3" placeholder="Opcional"></textarea>
                </label>
                <label>
                  Tipo de soporte
                  <select id="expense-support" required></select>
                </label>
                <label>
                  Comprobante (foto)
                  <input type="file" id="expense-receipt" accept="image/*" required />
                </label>
                <div class="file-preview" id="receipt-preview">
                  <span class="file-preview__label">Sin archivo seleccionado</span>
                </div>
                <div class="notice" id="expense-warning"></div>
                <button type="submit" class="button">Registrar egreso</button>
                <p class="form__helper" id="expense-message"></p>
                <p class="form__helper">
                  Si la sincronizaci√≥n est√° activa, el soporte se guardar√° autom√°ticamente en Drive.
                </p>
              </form>

              <div class="card">
                <div class="card__header">
                  <h3>Historial de egresos</h3>
                  <p>Registros con soporte fotogr√°fico asociado.</p>
                </div>
                <div id="expense-table" class="list"></div>
              </div>

              <div class="card hidden" id="concept-card">
                <div class="card__header">
                  <h3>Conceptos de gasto</h3>
                  <p>Administra los conceptos disponibles para el registro de egresos.</p>
                </div>
                <form id="concept-form" class="form">
                  <label>
                    Nuevo concepto
                    <input type="text" id="concept-name" placeholder="Ej: Compra de materiales" required />
                  </label>
                  <button type="submit" class="button button--ghost">Agregar concepto</button>
                  <p class="form__helper" id="concept-message"></p>
                </form>
              </div>
            </div>
          </div>

          <div class="view" data-view="reports">
            <div class="card-grid">
              <div class="card">
                <div class="card__header">
                  <h3>Reportes y sincronizaci√≥n</h3>
                  <p>Guarda los cambios y exporta el historial de egresos cuando sea necesario.</p>
                </div>
                <div class="report-actions">
                  <button class="button button--ghost" id="sync-button" type="button">Guardar</button>
                  <button class="button button--ghost" id="export-button" type="button">Exportar Excel</button>
                </div>
                <div class="report-status">
                  <span class="label">Estado</span>
                  <p id="sheet-status" class="status-message"></p>
                </div>
                <div class="report-status">
                  <span class="label">Carpeta Drive</span>
                  <p id="drive-folder"></p>
                </div>
              </div>
            </div>
          </div>

          <div class="view" data-view="users" id="admin-section">
            <div class="card-grid">
              <form id="user-form" class="form card">
                <h3>Crear usuario</h3>
                <label>
                  Nombre
                  <input type="text" id="user-name" required />
                </label>
                <label>
                  Correo electr√≥nico (opcional)
                  <input type="email" id="user-email" placeholder="correo@empresa.com" />
                </label>
                <label>
                  Usuario
                  <input type="text" id="user-username" required />
                </label>
                <label>
                  Contrase√±a
                  <input type="password" id="user-password" required />
                </label>
                <label>
                  Rol
                  <select id="user-role" required>
                    <option value="empleado">Empleado</option>
                  </select>
                </label>
                <button type="submit" class="button">Guardar usuario</button>
                <p class="form__helper" id="user-message"></p>
              </form>

              <div class="card">
                <div class="card__header">
                  <h3>Usuarios activos</h3>
                  <p>Controla el acceso al aplicativo.</p>
                </div>
                <div id="user-list" class="list"></div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        sendPasswordResetEmail,
      } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
      import {
        getFirestore,
        collection,
        doc,
        getDoc,
        getDocs,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

      // üî¥ PEGA aqu√≠ tu firebaseConfig (Firebase Console ‚Üí Project settings ‚Üí Your apps ‚Üí Web)
      const firebaseConfig = {
        apiKey: "AIzaSyAOR0mDTR_MAULqNioSdgRH8IoDv_Lp4rI",
        authDomain: "ingenieria-sas.firebaseapp.com",
        projectId: "ingenieria-sas",
        appId: "1:856625753506:web:68fbe9c28a79ee703756fb",
      };

      const fbApp = initializeApp(firebaseConfig);
      const auth = getAuth(fbApp);
      const db = getFirestore(fbApp);

      window.__fb = {
        auth,
        db,
        collection,
        doc,
        getDoc,
        getDocs,
        setDoc,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        sendPasswordResetEmail,
      };
    </script>

    <script src="app.js"></script>
  </body>
</html>
